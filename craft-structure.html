<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
	<meta charset="utf-8"/>
</head>
<body>

<h1 id="craftcms5.xstructureforportertaskmanagement">Craft CMS 5.x Structure for Porter Task Management</h1>

<h2 id="overview">Overview</h2>

<p>Craft CMS 5.x introduces new approaches to content modeling. In this document, I&#8217;ll outline how to structure the Porter Task Management application using Craft&#8217;s latest features.</p>

<h2 id="elementtypes">Element Types</h2>

<p>For this application, we&#8217;ll use a mix of Craft&#8217;s built-in element types and custom element types to better model the domain.</p>

<h3 id="1.customelementtypes">1. Custom Element Types</h3>

<p>We&#8217;ll create custom element types for domain-specific entities:</p>

<h4 id="a.staffelementtype">A. Staff Element Type</h4>

<ul>
<li><strong>Class</strong>: <code>app\elements\Staff</code></li>
<li><strong>Table</strong>: <code>porter_staff</code></li>
<li><strong>Fields</strong>:</li>
<li> Name (text)</li>
<li> Email (email)</li>
<li> Active Status (lightswitch)</li>
<li> Custom Properties:

<ul>
<li>staffId (UUID)</li>
</ul></li>
</ul>

<h4 id="b.taskelementtype">B. Task Element Type</h4>

<ul>
<li><strong>Class</strong>: <code>app\elements\Task</code></li>
<li><strong>Table</strong>: <code>porter_tasks</code></li>
<li><strong>Fields</strong>:</li>
<li> Title (derived from task details)</li>
<li> Status (custom status - pending, completed, archived)</li>
<li> Custom Properties:

<ul>
<li>timeReceived (datetime)</li>
<li>timeAllocated (datetime)</li>
<li>timeCompleted (datetime)</li>
<li>transportType (string)</li>
<li>Relations:</li>
<li> jobCategory (relation to Category element)</li>
<li> fromDepartment (relation to Department element)</li>
<li> toDepartment (relation to Department element)</li>
<li> itemType (relation to JobType element)</li>
<li> assignedStaff (relation to Staff element)</li>
</ul></li>
</ul>

<h3 id="2.craftsbuilt-inelementtypes">2. Craft&#8217;s Built-in Element Types</h3>

<h4 id="a.categories">A. Categories</h4>

<p>We&#8217;ll use Craft&#8217;s built-in Categories element type for:</p>

<ol>
<li><strong>Buildings Category Group</strong></li>
</ol>

<ul>
<li> Handle: <code>buildings</code></li>
<li> Fields:

<ul>
<li> Name (built-in)</li>
</ul></li>
</ul>

<ol>
<li><strong>Departments Category Group</strong></li>
</ol>

<ul>
<li> Handle: <code>departments</code></li>
<li> Fields:

<ul>
<li> Name (built-in)</li>
<li> Building (categories field, related to Buildings)</li>
</ul></li>
</ul>

<ol>
<li><strong>Job Types Category Group</strong></li>
</ol>

<ul>
<li> Handle: <code>jobTypes</code></li>
<li> Fields:

<ul>
<li> Name (built-in)</li>
<li> Transport Options (table field with options)</li>
</ul></li>
</ul>

<ol>
<li><strong>Job Categories Category Group</strong></li>
</ol>

<ul>
<li> Handle: <code>jobCategories</code></li>
<li> Fields:

<ul>
<li> Name (built-in)</li>
<li> Allowed Types (categories field, related to Job Types)</li>
</ul></li>
</ul>

<h2 id="databaseschema">Database Schema</h2>

<p>The following database schema represents the relationships between these elements:</p>

<pre><code>Staff (Custom Element)
└── staffId, name, email, active

Task (Custom Element)
├── id, title, status
├── timeReceived, timeAllocated, timeCompleted, transportType
└── Relations:
    ├── jobCategory
    ├── fromDepartment
    ├── toDepartment
    ├── itemType
    └── assignedStaff

Buildings (Category)
└── id, name

Departments (Category)
├── id, name
└── buildingId (relation)

Job Types (Category)
├── id, name
└── transportOptions (JSON field)

Job Categories (Category)
├── id, name
└── allowedTypes (relations)
</code></pre>

<h2 id="graphqlschema">GraphQL Schema</h2>

<p>Craft 5.x has robust GraphQL support built-in. We&#8217;ll expose the following GraphQL schema:</p>

<pre><code class="graphql">type Staff {
  id: ID!
  name: String!
  email: String
  active: Boolean!
}

type Building {
  id: ID!
  title: String!
  departments: [Department!]
}

type Department {
  id: ID!
  title: String!
  building: Building!
}

type JobType {
  id: ID!
  title: String!
  transportOptions: [String!]
}

type JobCategory {
  id: ID!
  title: String!
  allowedTypes: [JobType!]!
}

type Task {
  id: ID!
  title: String!
  status: String!
  timeReceived: DateTime!
  timeAllocated: DateTime
  timeCompleted: DateTime
  transportType: String
  jobCategory: JobCategory!
  fromDepartment: Department!
  toDepartment: Department!
  itemType: JobType!
  assignedStaff: Staff
}

type Query {
  buildings: [Building!]!
  departments(buildingId: ID): [Department!]!
  jobTypes: [JobType!]!
  jobCategories: [JobCategory!]!
  staff(active: Boolean = true): [Staff!]!
  
  pendingTasks(date: Date, shift: String): [Task!]!
  completedTasks(date: Date, shift: String): [Task!]!
  task(id: ID!): Task
}

type Mutation {
  createTask(input: TaskInput!): Task!
  updateTask(id: ID!, input: TaskInput!): Task!
  assignTask(id: ID!, staffId: ID!): Task!
  completeTask(id: ID!, completionTime: DateTime): Task!
  archiveTasks(date: Date!, shift: String!): Boolean!
}

input TaskInput {
  timeReceived: DateTime!
  jobCategoryId: ID!
  fromDepartmentId: ID!
  toDepartmentId: ID!
  itemTypeId: ID!
  transportType: String
  staffId: ID
  status: String
  timeAllocated: DateTime
  timeCompleted: DateTime
}
</code></pre>

<h2 id="projectsetup">Project Setup</h2>

<h3 id="1.custommodulesetup">1. Custom Module Setup</h3>

<p>Create a <code>porter</code> module:</p>

<pre><code>modules/
└── porter/
    ├── Porter.php
    ├── elements/
    │   ├── Staff.php
    │   └── Task.php
    ├── migrations/
    │   └── Install.php
    ├── records/
    │   ├── StaffRecord.php
    │   └── TaskRecord.php
    └── controllers/
        ├── TasksController.php
        └── ApiController.php
</code></pre>

<h3 id="2.graphqlsetup">2. GraphQL Setup</h3>

<ol>
<li>Enable GraphQL in Craft settings</li>
<li>Create a schema for the Porter application</li>
<li>Define types based on our element types</li>
<li>Set up queries and mutations</li>
</ol>

<h3 id="3.frontendintegration">3. Frontend Integration</h3>

<p>We&#8217;ll use Vue.js with the Apollo GraphQL client:</p>

<pre><code class="javascript">// Example of querying departments for a building
const getDepartments = gql`
  query GetDepartments($buildingId: ID!) {
    departments(buildingId: $buildingId) {
      id
      title
    }
  }
`;

// Then in a Vue component:
apollo: {
  departments: {
    query: getDepartments,
    variables() {
      return {
        buildingId: this.selectedBuildingId
      }
    }
  }
}
</code></pre>

<h2 id="nextsteps">Next Steps</h2>

<ol>
<li>Create the custom element types in Craft</li>
<li>Set up the category groups</li>
<li>Define the GraphQL schema</li>
<li>Update the frontend to query the GraphQL API</li>
</ol>

</body>
</html>

